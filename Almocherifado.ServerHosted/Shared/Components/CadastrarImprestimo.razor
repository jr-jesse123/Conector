@page "/teste"

@using Almocherifado.ServerHosted.Shared.FormularioCadastroImprestimo

<EditForm Model="Model">
    <FluentValidationValidator />
    <DataDeEntrega @bind-Data="Model.Entrega" />
    <ValidationMessage For="() =>Model.Entrega"></ValidationMessage>

    <FuncionarioSelect FuncionariosSource="Funcionarios" @bind-ParentsCPF="Model.FuncionarioCpf" />
    <ValidationMessage For="() =>Model.FuncionarioCpf"></ValidationMessage>

    <ObraInput  @bind-Obra="Model.Obra"/>
    <ValidationMessage For="() =>Model.Obra"></ValidationMessage>


    <Field Horizontal="true">
        <FieldLabel ColumnSize="ColumnSize.Is4.OnDesktop">Termo de Responsabilidade:</FieldLabel>
        <FieldBody>
            <Addons>
                <Addon AddonType="AddonType.Body">
                    <Addon AddonType="AddonType.Start">
                        <Button Color="Color.Secondary">Gerar Termo</Button>
                    </Addon>
                    <FileEdit ></FileEdit>

                </Addon>
            </Addons>
        </FieldBody>
    </Field>
    <ValidationMessage For="() =>Model.TermoResponsabilidade"></ValidationMessage>

    <Button Type="ButtonType.Submit" Color="Color.Primary">Alocar Ferramentas</Button>
    <Button Type="ButtonType.Reset" Color="Color.Light">Cancelar</Button>

</EditForm>

@code {
    EmprestimoModel Model = new() { Entrega = DateTime.Now };
    [Inject] IFuncionariosRepository repository { get; set; }
    public List<Funcionario> Funcionarios { get; set; }

    protected override void OnInitialized()
    {
        Funcionarios = repository.GetFuncionarios().ToList();
    }

    void OnValidSubmit()
    {
        //var ferramenta = mapper.Map<Ferramenta>(ferramentamodel);
        //repository.AdicionarFerramenta(ferramenta);

        //Directory.CreateDirectory(Path.GetDirectoryName(environment.WebRootPath + ferramentamodel.FotoUrl));
        //File.WriteAllBytes(environment.WebRootPath + ferramentamodel.FotoUrl, fileContent);

        //mensagem = "Ferrramenta Criada Com sucesso!";
        //Cor = Color.Success;
        //AlertRef.Show();
    }

}
