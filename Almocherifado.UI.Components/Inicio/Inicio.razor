@using Almocherifado.UI.Components.Ferramentas.Status

<div class="row">
    <div class="container h-100 mt-5">
        <div class="row">
            <div class="col" >
                <h2>QUADRO RESUMO</h2>
                <div class="input-group" ;">
                    <input type="text" class="form-control">

                    <span class="input-group-text">

                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M10.442 10.4417C10.5349 10.3487 10.6452 10.275 10.7666 10.2247C10.888 10.1743 11.0181 10.1484 11.1495 10.1484C11.2809 10.1484 11.411 10.1743 11.5324 10.2247C11.6538 10.275 11.7641 10.3487 11.857 10.4417L15.707 14.2917C15.8946 14.4792 16.0001 14.7336 16.0002 14.9989C16.0003 15.2641 15.895 15.5186 15.7075 15.7062C15.52 15.8939 15.2656 15.9993 15.0004 15.9994C14.7351 15.9995 14.4806 15.8942 14.293 15.7067L10.443 11.8567C10.35 11.7639 10.2763 11.6536 10.2259 11.5322C10.1756 11.4108 10.1497 11.2806 10.1497 11.1492C10.1497 11.0178 10.1756 10.8877 10.2259 10.7663C10.2763 10.6449 10.35 10.5346 10.443 10.4417H10.442Z" fill="#05374D" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M6.5 12C7.22227 12 7.93747 11.8577 8.60476 11.5813C9.27205 11.3049 9.87837 10.8998 10.3891 10.3891C10.8998 9.87837 11.3049 9.27205 11.5813 8.60476C11.8577 7.93747 12 7.22227 12 6.5C12 5.77773 11.8577 5.06253 11.5813 4.39524C11.3049 3.72795 10.8998 3.12163 10.3891 2.61091C9.87837 2.10019 9.27205 1.69506 8.60476 1.41866C7.93747 1.14226 7.22227 1 6.5 1C5.04131 1 3.64236 1.57946 2.61091 2.61091C1.57946 3.64236 1 5.04131 1 6.5C1 7.95869 1.57946 9.35764 2.61091 10.3891C3.64236 11.4205 5.04131 12 6.5 12ZM13 6.5C13 8.22391 12.3152 9.87721 11.0962 11.0962C9.87721 12.3152 8.22391 13 6.5 13C4.77609 13 3.12279 12.3152 1.90381 11.0962C0.684819 9.87721 0 8.22391 0 6.5C0 4.77609 0.684819 3.12279 1.90381 1.90381C3.12279 0.684819 4.77609 0 6.5 0C8.22391 0 9.87721 0.684819 11.0962 1.90381C12.3152 3.12279 13 4.77609 13 6.5Z" fill="#05374D" />
                            </g>
                            <defs>
                                <clipPath id="clip0">
                                    <rect width="16" height="16" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>
                    </span>
                </div>
                <div class="my-3">
                    <label for="exampleInputEmail1" class="form-label">
                        <b>*</b>Patrimônio
                        <input @oninput="(text) => OnPatrimonioChage(text)" type="number" class="form-control my-2">
                    </label>
                </div>

            </div>
            <div class="col">
                <div class="card text-dark bg-light mb-3">
                    <div class="card-body">
                        @if (FerramentaSelecionada is not null)
                        {
                            @if (FerramentaSelecionada is not null)
                            {

                                if (Alocacoes
                                        .Any(aloc => aloc.FerramentasAlocadas
                                        .Where(fa => !fa.Devolvida).Select(f => f.Ferramenta).Contains(FerramentaSelecionada)))
                                {
                                    var aloc = Alocacoes
                                                   .Where(aloc => aloc.FerramentasAlocadas.Where(fa => !fa.Devolvida)
                                                                                           .Select(fa => fa.Ferramenta)
                                                                                           .Contains(FerramentaSelecionada))
                                                   .Single();

                                        <div style="height:150px">
                                            <h1>@FerramentaSelecionada.Nome</h1>
                                            <h5> <strong>Patrimônio:</strong> @FerramentaSelecionada.Patrimonio</h5>
                                            <h3 class="d-3">Ferramenta Alocada</h3>
                                        </div>
                                }
                                else if (FerramentaSelecionada.EmManutencao)
                                {
                                    <div style="height:150px">
                                        <h1>@FerramentaSelecionada.Nome</h1>
                                        <h5> <strong>Patrimônio:</strong> @FerramentaSelecionada.Patrimonio</h5>
                                        <h3 class="Text-Danger d-3">Ferramenta Em Manutenção</h3>
                                    </div>
                                }
                                else
                                {
                                    <div style="height:150px">
                                        <h1>@FerramentaSelecionada.Nome</h1>
                                        <h5> <strong>Patrimônio:</strong> @FerramentaSelecionada.Patrimonio</h5>
                                        <h3 class="Text-Success d-3">Disponível para Alocação</h3>
                                    </div>
                                }
                            }
                        }
                        else
                        {

                            <h5 class="card-title"> <b>FERRAMENTAS</b></h5>
                            <table>
                                <tr>
                                    <td>
                                        <b class="fs-3">@FerramentasCadastradas</b>
                                    </td>
                                    <td>
                                        <p class="mx-3 my-auto">FERRAMENTAS CADASTRADAS</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <b class="fs-3 text-success">@FerramentasDisponiveis</b>
                                    </td>
                                    <td>
                                        <p class="mx-3 my-auto">FERRAMENTAS DISPONÍVEIS</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <b class="fs-3 text-danger">@FerramentasAlocadas</b>
                                    </td>
                                    <td>
                                        <p class="mx-3 my-auto">FERRAMENTAS ALOCADAS</p>
                                    </td>
                                </tr>
                            </table>
                        }
                    </div>
                </div>
            </div>
        </div>

        @if (AlocacoesAtuais is not null && AlocacoesAtuais.Length > 0)
        {
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">FERRAMENTA</th>
                        <th scope="col">RESPONSÁVEL</th>
                        <th scope="col">CONTRATO</th>
                        <th scope="col">ALOCAÇÃO</th>
                        <th scope="col">DEVOLUÇÃO</th>
                    </tr>
                </thead>
                <tbody>

                    @if (PatrimonioAtual > 0)
                    {

                        @foreach (var ferramenta in ferramentasAtuais)
                        {
                            @foreach (var alocacao in AlocacoesAtuais)
                            {
                                var ferramentaAlocada = alocacao.FerramentasAlocadas.First(d => d.Ferramenta.Patrimonio == ferramenta.Patrimonio);
                                <tr>
                                    <HistoricoFerramentaTr Alocacao="alocacao" Ferramenta="ferramenta"></HistoricoFerramentaTr>
                                </tr>

                            
                                if (ferramentaAlocada.Devolvida && !string.IsNullOrWhiteSpace(ferramentaAlocada.Observacoes))
                                {
                                    <tr>
                                        <td colspan="5">
                                            <strong>Observações:</strong> @ferramentaAlocada.Observacoes;

                                        </td>
                                    </tr>
                                }

                            }
                        }
                    }

                </tbody>
            </table>
        }
    </div>
    @if (AlocacoesAtuais is not null && AlocacoesAtuais.Length > 0)
    {
        <div class="d-flex justify-content-end">
            <button class="btn btn-primary">Gerar Relatório</button>
        </div>
    }
    </div>
